# core Module

> ğŸ“ **Breadcrumb**: [Root](../CLAUDE.md) â†’ core

## Overview

æ ¸å¿ƒå·¥å…·æ¨¡å—ï¼Œæä¾›é…ç½®ç®¡ç†ã€æ™ºèƒ½é‡è¯•æ¡†æ¶ã€ç»Ÿä¸€æ•°æ®è§£æç­‰åŸºç¡€è®¾æ–½åŠŸèƒ½ã€‚

## Module Structure

```
core/
â”œâ”€â”€ __init__.py           # æ¨¡å—å¯¼å‡º
â”œâ”€â”€ config_manager.py     # é…ç½®ç®¡ç†å™¨ (å•ä¾‹æ¨¡å¼)
â”œâ”€â”€ data_parser.py        # ç»Ÿä¸€æ•°æ®è§£æå™¨
â””â”€â”€ retry_helper.py       # æ™ºèƒ½é‡è¯•æ¡†æ¶
```

## Components

### ConfigManager (config_manager.py)

**å•ä¾‹æ¨¡å¼**çš„é…ç½®ç®¡ç†å™¨ï¼Œæä¾› JSON é…ç½®æ–‡ä»¶çš„æŒä¹…åŒ–è¯»å†™ã€‚

**Key Features**:
- åµŒå¥— key æ”¯æŒï¼š`ConfigManager.get("timeouts.page_load", 30)`
- æ•æ„Ÿä¿¡æ¯åŠ å¯†ï¼šBase64 + XOR æ··æ·†
- çº¿ç¨‹å®‰å…¨ï¼šä½¿ç”¨ `threading.Lock`
- è‡ªåŠ¨åˆå¹¶é»˜è®¤é…ç½®

**Key Methods**:
| Method | Description |
|--------|-------------|
| `load()` | åŠ è½½é…ç½®ï¼Œä¸å­˜åœ¨åˆ™åˆ›å»ºé»˜è®¤ |
| `get(key, default)` | è·å–é…ç½®é¡¹ (æ”¯æŒåµŒå¥— key) |
| `set(key, value)` | è®¾ç½®é…ç½®é¡¹å¹¶è‡ªåŠ¨ä¿å­˜ |
| `get_api_key()` | è·å–è§£å¯†åçš„ SheerID API Key |
| `set_api_key(key)` | åŠ å¯†ä¿å­˜ API Key |

**Default Config**:
```json
{
  "sheerid_api_key": "",
  "default_thread_count": 3,
  "timeouts": {
    "page_load": 30,
    "status_check": 20,
    "iframe_wait": 15
  },
  "delays": {
    "after_login": 3,
    "after_offer": 8,
    "after_add_card": 10,
    "after_save": 18
  }
}
```

### DataParser (data_parser.py)

ç»Ÿä¸€çš„è´¦å·ä¿¡æ¯è§£æå™¨ï¼Œç¡®ä¿æ‰€æœ‰æ¨¡å—ä½¿ç”¨ä¸€è‡´çš„è§£æé€»è¾‘ã€‚

**Supported Formats**:
- `é‚®ç®±----å¯†ç ----è¾…åŠ©é‚®ç®±----2FAå¯†é’¥`
- `é“¾æ¥----é‚®ç®±----å¯†ç ----è¾…åŠ©é‚®ç®±----2FAå¯†é’¥`
- è‡ªåŠ¨æ£€æµ‹åˆ†éš”ç¬¦ï¼š`----`, `---`, `|`, `,`, `;`, `\t`

**Key Functions**:
| Function | Description |
|----------|-------------|
| `parse_account_line(line)` | è§£æè´¦å·è¡Œ â†’ (email, password, recovery, secret, link) |
| `build_account_line(...)` | æ„å»ºè´¦å·è¡Œå­—ç¬¦ä¸² |

### RetryHelper (retry_helper.py)

æ™ºèƒ½é‡è¯•æ¡†æ¶ï¼Œæ”¯æŒæŒ‡æ•°é€€é¿ç­–ç•¥ã€‚

**Key Classes**:
| Class | Description |
|-------|-------------|
| `RetryHelper` | æ”¯æŒåŒæ­¥/å¼‚æ­¥å‡½æ•°çš„è‡ªåŠ¨é‡è¯• |
| `FailedTaskQueue` | å¤±è´¥ä»»åŠ¡é˜Ÿåˆ—ç®¡ç† (æŒä¹…åŒ–åˆ° JSON) |

**RetryHelper Config**:
- `max_retries`: æœ€å¤§é‡è¯•æ¬¡æ•° (é»˜è®¤ 3)
- `base_delay`: åŸºç¡€å»¶è¿Ÿ (é»˜è®¤ 2.0s)
- `backoff_factor`: é€€é¿å› å­ (é»˜è®¤ 2.0)
- `max_delay`: æœ€å¤§å»¶è¿Ÿ (é»˜è®¤ 60.0s)

**Decorators**:
```python
from core import with_retry, with_retry_async

@with_retry(max_retries=3)
def my_function():
    ...

@with_retry_async(max_retries=3)
async def my_async_function():
    ...
```

## Usage Examples

```python
# é…ç½®ç®¡ç†
from core import ConfigManager

timeout = ConfigManager.get("timeouts.page_load", 30)
ConfigManager.set("default_thread_count", 5)

# æ•°æ®è§£æ
from core import parse_account_line, build_account_line

email, pwd, rec, sec, link = parse_account_line("user@mail.com----pass----backup@mail.com----SECRET")
line = build_account_line(email, pwd, rec, sec)

# é‡è¯•æ¡†æ¶
from core import RetryHelper, FailedTaskQueue

helper = RetryHelper(max_retries=3, base_delay=2.0)
result = await helper.execute_async(async_func, arg1, arg2)
```

## Dependencies

- **å†…éƒ¨ä¾èµ–**: æ—  (çº¯åŸºç¡€è®¾æ–½æ¨¡å—)
- **å¤–éƒ¨ä½¿ç”¨**: è¢« `auto_bind_card.py`, `run_playwright_google.py`, `create_window_gui.py` ç­‰æ¨¡å—ä½¿ç”¨

---

*Generated by /init-project*
